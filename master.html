<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NST Master Data</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">

  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>

  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f4f6f9;
      max-width: 800px;
      margin: 20px auto;
      padding: 20px;
    }
    h2 { color: #4b2aad; }
    label { font-weight: 600; display: block; margin-top: 10px; }
    input, button {
      padding: 10px; font-size: 15px; margin-top: 5px;
      border: 1px solid #ccc; border-radius: 5px;
    }
    button {
      background: #4b2aad; color: #fff;
      border: none; cursor: pointer; margin-top: 10px;
    }
    button:hover { background: #3a208b; }
    table {
      width: 100%; margin-top: 20px; border-collapse: collapse;
    }
    th, td {
      border: 1px solid #ccc; padding: 8px; font-size: 14px;
    }
    th { background: #4b2aad; color: #fff; }
    section { margin-bottom: 40px; }
  </style>
</head>
<body>

<h2>🛠️ NST Master Data</h2>

<section>
  <h3>👨‍✈️ Add Driver</h3>
  <label>Name</label>
  <input type="text" id="driverName">
  <label>Mobile</label>
  <input type="text" id="driverMobile">
  <button onclick="addDriver()">➕ Add Driver</button>
</section>

<section>
  <h3>🚘 Add Vehicle</h3>
  <label>Model</label>
  <input type="text" id="vehicleModel">
  <label>Number</label>
  <input type="text" id="vehicleNumber">
  <button onclick="addVehicle()">➕ Add Vehicle</button>
</section>

<section>
  <h3>📋 Add Duty</h3>
  <label>Duty Name</label>
  <input type="text" id="dutyName">
  <button onclick="addDuty()">➕ Add Duty</button>
</section>

<hr/>

<section>
  <h3>📄 Current Master Data</h3>
  <button onclick="loadMasters()">🔄 Refresh</button>
  <div id="masterDisplay"></div>
</section>

<script>
  const firebaseConfig = {
    apiKey: "AIzaSyDNnQtossolWIfqFw9dM2i3TjYZXpMKTrY",
    authDomain: "narayanan-selvi-travels-aafcc.firebaseapp.com",
    databaseURL: "https://narayanan-selvi-travels-aafcc-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "narayanan-selvi-travels-aafcc",
    storageBucket: "narayanan-selvi-travels-aafcc.firebasestorage.app",
    messagingSenderId: "439796129397",
    appId: "1:439796129397:web:3dc531e6fc4e7a0be3a23c"
  };
  firebase.initializeApp(firebaseConfig);
  const db = firebase.database();

  function addDriver() {
    const name = driverName.value.trim();
    const mobile = driverMobile.value.trim();
    if (!name || !mobile) return alert("Please enter both name and mobile");

    db.ref("masters/drivers").once("value").then(snap => {
      const list = snap.val() || [];
      list.push({ name, mobile });
      db.ref("masters/drivers").set(list).then(() => {
        alert("✅ Driver added");
        driverName.value = '';
        driverMobile.value = '';
        loadMasters();
      });
    });
  }

  function addVehicle() {
    const model = vehicleModel.value.trim();
    const number = vehicleNumber.value.trim();
    if (!model || !number) return alert("Please enter both model and number");

    db.ref("masters/vehicles").once("value").then(snap => {
      const list = snap.val() || [];
      list.push({ model, number });
      db.ref("masters/vehicles").set(list).then(() => {
        alert("✅ Vehicle added");
        vehicleModel.value = '';
        vehicleNumber.value = '';
        loadMasters();
      });
    });
  }

  function addDuty() {
    const name = dutyName.value.trim();
    if (!name) return alert("Please enter a duty name");

    db.ref("masters/duties").once("value").then(snap => {
      const list = snap.val() || [];
      list.push({ name });
      db.ref("masters/duties").set(list).then(() => {
        alert("✅ Duty added");
        dutyName.value = '';
        loadMasters();
      });
    });
  }

  function loadMasters() {
    db.ref("masters").once("value").then(snap => {
      const data = snap.val() || {};
      let html = "";

      html += "<h4>👨‍✈️ Drivers</h4><table><tr><th>Name</th><th>Mobile</th></tr>";
      (data.drivers || []).forEach(d => {
        html += `<tr><td>${d.name}</td><td>${d.mobile}</td></tr>`;
      });
      html += "</table>";

      html += "<h4>🚘 Vehicles</h4><table><tr><th>Model</th><th>Number</th></tr>";
      (data.vehicles || []).forEach(v => {
        html += `<tr><td>${v.model}</td><td>${v.number}</td></tr>`;
      });
      html += "</table>";

      html += "<h4>📋 Duties</h4><table><tr><th>Duty</th></tr>";
      (data.duties || []).forEach(d => {
        html += `<tr><td>${d.name}</td></tr>`;
      });
      html += "</table>";

      masterDisplay.innerHTML = html;
    });
  }

  window.onload = loadMasters;
</script>

</body>
</html>
