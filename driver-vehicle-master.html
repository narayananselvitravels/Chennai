<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Trips â€“ NST Travels</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; margin: 20px; background: #f4f6f9; color: #333; }
    h2 { color: #4b2aad; }
    .summary-boxes { display: flex; gap: 15px; flex-wrap: wrap; margin: 15px 0; }
    .summary-box {
      flex: 1;
      background: white;
      padding: 15px;
      border-radius: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      text-align: center;
    }
    .filters { display: flex; gap: 15px; flex-wrap: wrap; margin: 20px 0; }
    .filters select, .filters input {
      padding: 10px;
      font-size: 14px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }
    table {
      width: 100%; border-collapse: collapse; margin-top: 15px;
      background: white; box-shadow: 0 2px 5px rgba(0,0,0,0.05);
    }
    th, td { padding: 10px; border: 1px solid #ddd; }
    th { background: #4b2aad; color: white; }
    td.paid { color: green; font-weight: bold; }
    td.unpaid { color: red; font-weight: bold; }
  </style>
</head>
<body>

<h2>ðŸ“‹ All Trips â€“ NST Travels</h2>

<div class="summary-boxes">
  <div class="summary-box"><strong>Total Trips:</strong><div id="totalTrips">0</div></div>
  <div class="summary-box"><strong>Total Amount:</strong><div id="totalAmount">â‚¹0</div></div>
  <div class="summary-box"><strong>Unpaid Trips:</strong><div id="unpaidCount">0</div></div>
  <div class="summary-box"><strong>This Month:</strong><div id="thisMonth">0</div></div>
</div>

<div class="filters">
  <input type="text" id="filterDriver" placeholder="Driver Name">
  <input type="text" id="filterVehicle" placeholder="Vehicle Model">
  <select id="filterStatus">
    <option value="">All Status</option>
    <option value="Paid">Paid</option>
    <option value="Not Paid">Not Paid</option>
  </select>
  <input type="date" id="fromDate">
  <input type="date" id="toDate">
  <button onclick="applyFilters()">Apply Filters</button>
</div>

<table>
  <thead>
    <tr>
      <th>ID</th><th>Date</th><th>Pickup</th><th>Drop</th><th>Driver</th><th>Vehicle</th>
      <th>KM</th><th>Amount</th><th>Status</th>
    </tr>
  </thead>
  <tbody id="tripTable"></tbody>
</table>

<script>
const SHKEY = "shared-trips";
let trips = JSON.parse(localStorage.getItem(SHKEY) || "[]");

function formatDate(dstr) {
  if (!dstr) return "";
  const d = new Date(dstr);
  return `${d.getDate().toString().padStart(2, '0')}-${(d.getMonth()+1).toString().padStart(2,'0')}-${d.getFullYear()}`;
}

function loadTrips(list = trips) {
  const tbody = document.getElementById("tripTable");
  tbody.innerHTML = "";
  let total = 0, unpaid = 0, thisMonth = 0;
  const now = new Date();
  list.forEach(t => {
    const isUnpaid = t.paymentStatus === "Not Paid";
    const amt = parseFloat(t.totalAmount || 0);
    const date = new Date(t.date);
    if (isUnpaid) unpaid++;
    if (date.getMonth() === now.getMonth() && date.getFullYear() === now.getFullYear()) thisMonth++;
    total += amt;
    tbody.innerHTML += `
      <tr>
        <td>${t.id}</td>
        <td>${formatDate(t.date)}</td>
        <td>${t.pickup}</td>
        <td>${t.drop}</td>
        <td>${t.driverName}</td>
        <td>${t.vehicleModel}</td>
        <td>${t.totalKM}</td>
        <td>â‚¹${amt}</td>
        <td class="${isUnpaid ? 'unpaid' : 'paid'}">${t.paymentStatus}</td>
      </tr>`;
  });
  document.getElementById("totalTrips").innerText = list.length;
  document.getElementById("totalAmount").innerText = `â‚¹${total}`;
  document.getElementById("unpaidCount").innerText = unpaid;
  document.getElementById("thisMonth").innerText = thisMonth;
}

function applyFilters() {
  let fDriver = document.getElementById("filterDriver").value.toLowerCase();
  let fVehicle = document.getElementById("filterVehicle").value.toLowerCase();
  let fStatus = document.getElementById("filterStatus").value;
  let from = new Date(document.getElementById("fromDate").value);
  let to = new Date(document.getElementById("toDate").value);

  const filtered = trips.filter(t => {
    let match = true;
    if (fDriver && !t.driverName.toLowerCase().includes(fDriver)) match = false;
    if (fVehicle && !t.vehicleModel.toLowerCase().includes(fVehicle)) match = false;
    if (fStatus && t.paymentStatus !== fStatus) match = false;
    if (document.getElementById("fromDate").value && new Date(t.date) < from) match = false;
    if (document.getElementById("toDate").value && new Date(t.date) > to) match = false;
    return match;
  });
  loadTrips(filtered);
}

loadTrips();
</script>
</body>
</html>
