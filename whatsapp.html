<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Share Trip via WhatsApp – NST Travels</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family:'Poppins',sans-serif;
      padding: 20px; max-width: 800px; margin: auto;
      background: #f4f6f9;
    }
    h2 { color: #4b2aad }
    select, textarea, button {
      width: 100%; padding: 12px;
      font-size: 16px; margin: 10px 0;
      border: 1px solid #ccc; border-radius: 5px;
    }
    button {
      background: #4b2aad; color: #fff;
      border: none; cursor: pointer;
    }
    button:hover { background: #3a208b }
    textarea { height: 250px; resize: vertical; }
    .nav-buttons {
      display: flex; gap: 10px; margin-top: 10px;
    }
    .nav-buttons button {
      flex: 1;
    }
  </style>
</head>
<body>

<h2>📤 Share Trip via WhatsApp</h2>

<label for="tripSelector">Select a Trip</label>
<select id="tripSelector" onchange="generateMessage()">
  <option value="">-- Choose Trip --</option>
</select>

<label for="whatsappMsg">Preview Message</label>
<textarea id="whatsappMsg" readonly></textarea>

<div class="nav-buttons">
  <button onclick="shareNow()">📲 Send via WhatsApp</button>
  <button onclick="window.location.href='index.html'">⬅️ Back to Trip Sheet</button>
</div>

<script>
  const tripSelector = document.getElementById("tripSelector");
  const whatsappMsg = document.getElementById("whatsappMsg");
  const savedTrips = JSON.parse(localStorage.getItem("shared-trips") || "[]");

  function populateDropdown() {
    savedTrips.forEach((trip, index) => {
      const option = document.createElement("option");
      option.value = index;
      option.textContent = `${trip.id} | ${trip.date} | ${trip.custName}`;
      tripSelector.appendChild(option);
    });
  }

  function generateMessage() {
    const i = tripSelector.value;
    if (i === "") return whatsappMsg.value = "";

    const t = savedTrips[i];

    whatsappMsg.value =
`📋 *TRIP SUMMARY*\n\n*Trip ID:* ${t.id}\n*Date:* ${t.date}\n\n` +
`📍 *Pickup:* ${t.pickup}\n📍 *Drop:* ${t.drop}\n\n` +
`👤 *Customer:* ${t.custName} (${t.custNumber})\n` +
`👨‍✈️ *Driver:* ${t.driverName} (${t.driverNumber})\n` +
`🚘 *Vehicle:* ${t.vehicleModel} (${t.vehicleNo})\n\n` +
`🕒 *Time:* ${t.start} - ${t.end} (${t.duration} hrs, Extra ${t.extraHours} hrs)\n` +
`📏 *KM:* ${t.startKM} - ${t.endKM} = ${t.totalKM} km (Extra ${t.extraKM} km)\n` +
`💰 *Amount:* ₹${t.totalAmount} | *Status:* ${t.paymentStatus}\n\n` +
`📝 *Note:* ${t.note || '-'}`;
  }

  function shareNow() {
    if (!whatsappMsg.value.trim()) return alert("Please select a trip to share.");
    const link = "https://wa.me/?text=" + encodeURIComponent(whatsappMsg.value);
    window.open(link, '_blank');
  }

  window.onload = populateDropdown;
</script>

</body>
</html>
