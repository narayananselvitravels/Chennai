<!DOCTYPE html><html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Invoice ‚Äì NST Travels</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f9f9fc;
      padding: 20px;
      color: #333;
    }
    .invoice-container {
      background: #fff;
      padding: 30px;
      max-width: 800px;
      margin: auto;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .invoice-header {
      display: flex;
      justify-content: space-between;
      border-bottom: 2px solid #4b2aad;
      padding-bottom: 15px;
      margin-bottom: 20px;
    }
    .invoice-header h1 {
      color: #4b2aad;
      font-size: 28px;
    }
    .row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    input, textarea {
      font-family: 'Poppins';
      padding: 6px;
      font-size: 14px;
      width: 100%;
      box-sizing: border-box;
    }
    .table {
      width: 100%;
      border-collapse: collapse;
      margin-top: 20px;
    }
    .table th, .table td {
      border: 1px solid #ccc;
      padding: 10px;
    }
    .table th {
      background: #4b2aad;
      color: #fff;
    }
    .totals {
      margin-top: 20px;
      width: 300px;
      float: right;
    }
    .totals .row {
      display: flex;
      justify-content: space-between;
      margin-bottom: 10px;
    }
    .btn {
      padding: 10px 20px;
      margin: 5px;
      background: #4b2aad;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    .btn:hover {
      background: #3a208b;
    }
    @media print {
      #downloadButtons, #tripSelect, .topbar {
        display: none !important;
      }
    }
  </style>
</head>
<body>
  <div class="topbar" style="text-align:center; margin-bottom:20px">
    <label><strong>üîç Load Trip ID:</strong></label>
    <select id="tripSelect" onchange="loadTripData(this.value)">
      <option value="">-- Select Trip ID --</option>
    </select>
  </div>  <div class="invoice-container" id="invoice">
    <div class="invoice-header">
      <h1>üöñ NST Travels</h1>
      <div>
        <p><strong>Invoice No:</strong> <input id="invId" value="#NST001" /></p>
        <p><strong>Date:</strong> <input id="invDate" value="10-July-2025" /></p>
      </div>
    </div><div class="row">
  <div style="width:48%">
    <h3>üë§ Customer</h3>
    <p><strong>Name:</strong> <input id="custName" value="John Doe" /></p>
    <p><strong>Phone:</strong> <input id="custNumber" value="9876543210" /></p>
  </div>
  <div style="width:48%">
    <h3>üë®‚Äç‚úàÔ∏è Driver</h3>
    <p><strong>Name:</strong> <input id="driverName" value="Perumal" /></p>
    <p><strong>Phone:</strong> <input id="driverNumber" value="9699994563" /></p>
  </div>
</div>

<div class="row">
  <div style="width:48%">
    <h3>üöò Trip Info</h3>
    <p><strong>Model:</strong> <input id="vehicleModel" value="Innova Crysta" /></p>
    <p><strong>Vehicle No:</strong> <input id="vehicleNo" value="PY05N0505" /></p>
  </div>
  <div style="width:48%">
    <p><strong>Pickup:</strong> <input id="pickup" value="Auroville" /></p>
    <p><strong>Drop:</strong> <input id="drop" value="Chennai Airport" /></p>
  </div>
</div>

<table class="table" id="chargesTable">
  <thead>
    <tr><th>Item</th><th>Details</th><th>Amount (‚Çπ)</th></tr>
  </thead>
  <tbody></tbody>
</table>

<div class="totals">
  <div class="row"><div>Subtotal:</div><div id="subtotal">‚Çπ0</div></div>
  <div class="row"><div>Discount (‚Çπ):</div><input type="number" id="discount" value="0" oninput="updateTotal()" /></div>
  <div class="row"><strong>Total:</strong><strong id="total">‚Çπ0</strong></div>
</div>

<div class="note" style="margin-top: 40px;">
  <label><strong>üìù Note:</strong></label>
  <textarea id="note" rows="3" style="width: 100%;">Thank you for choosing NST Travels. For any queries, contact us at +91-9876543210.</textarea>
</div>

<div id="downloadButtons" style="text-align:center; margin-top: 30px;">
  <button class="btn" onclick="window.print()">üñ∏Ô∏è Print Invoice</button>
  <button class="btn" onclick="downloadPDF()">üìÄ Download PDF</button>
  <button class="btn" onclick="downloadImage()">üéº Download Image</button>
  <button class="btn" onclick="shareViaWhatsApp()">üì§ Share via WhatsApp</button>
</div>

  </div>  <script>
    const sampleTrips = [
      {
        id: "#NST001",
        date: "10-July-2025",
        custName: "John Doe",
        custNumber: "9876543210",
        driverName: "Perumal",
        driverNumber: "9699994563",
        vehicleModel: "Innova Crysta",
        vehicleNo: "PY05N0505",
        pickup: "Auroville",
        drop: "Chennai Airport",
        note: "Flight at 5PM",
        charges: [
          ["Package", "Innova Crysta ‚Äì 8 hrs / 80 KM", 7500],
          ["Extra Hours", "2 hrs √ó ‚Çπ1000/hr", 2000],
          ["Extra KM", "10 km √ó ‚Çπ20/km", 200],
          ["Toll", "--", 150],
          ["Parking", "--", 100]
        ],
        discount: 0
      }
    ];

    if (!localStorage.getItem("tripData")) {
      localStorage.setItem("tripData", JSON.stringify(sampleTrips));
    }

    function populateTripDropdown() {
      const trips = JSON.parse(localStorage.getItem("tripData"));
      const select = document.getElementById("tripSelect");
      trips.forEach(t => {
        const opt = document.createElement("option");
        opt.value = t.id;
        opt.textContent = t.id;
        select.appendChild(opt);
      });
    }

    function loadTripData(id) {
      const trips = JSON.parse(localStorage.getItem("tripData"));
      const data = trips.find(t => t.id === id);
      if (!data) return;
      document.getElementById("invId").value = data.id;
      document.getElementById("invDate").value = data.date;
      document.getElementById("custName").value = data.custName;
      document.getElementById("custNumber").value = data.custNumber;
      document.getElementById("driverName").value = data.driverName;
      document.getElementById("driverNumber").value = data.driverNumber;
      document.getElementById("vehicleModel").value = data.vehicleModel;
      document.getElementById("vehicleNo").value = data.vehicleNo;
      document.getElementById("pickup").value = data.pickup;
      document.getElementById("drop").value = data.drop;
      document.getElementById("note").value = data.note;
      document.getElementById("discount").value = data.discount;
      const tbody = document.querySelector("#chargesTable tbody");
      tbody.innerHTML = "";
      data.charges.forEach(row => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${row[0]}</td><td><input type="text" class="detail" value="${row[1]}"/></td><td><input type="number" class="amount" value="${row[2]}"/></td>`;
        tbody.appendChild(tr);
      });
      updateTotal();
    }

    function updateTotal() {
      let subtotal = 0;
      document.querySelectorAll("#chargesTable tbody tr").forEach(row => {
        const detail = row.querySelector(".detail")?.value;
        const amountInput = row.querySelector(".amount");
        if (detail.includes("√ó")) {
          const [qtyPart, ratePart] = detail.split("√ó");
          const qty = parseFloat(qtyPart);
          const rate = parseFloat(ratePart.replace(/[^0-9.]/g, ""));
          const amt = Math.round(qty * rate);
          amountInput.value = amt;
          subtotal += amt;
        } else {
          subtotal += parseFloat(amountInput.value) || 0;
        }
      });
      document.getElementById("subtotal").innerText = `‚Çπ${subtotal}`;
      const discount = parseFloat(document.getElementById("discount").value) || 0;
      document.getElementById("total").innerText = `‚Çπ${subtotal - discount}`;
    }

    function getFileName() {
      const id = document.getElementById("invId").value.trim().replace(/#/g, "");
      const date = document.getElementById("invDate").value.trim().replace(/\s+/g, "-");
      return `Invoice_${id}_${date}`;
    }

    function downloadPDF() {
      document.getElementById("downloadButtons").style.display = "none";
      html2pdf().from(document.getElementById("invoice")).set({
        margin: 0,
        filename: getFileName() + ".pdf",
        image: { type: 'jpeg', quality: 1 },
        html2canvas: { scale: 2 },
        jsPDF: { unit: 'mm', format: 'a4', orientation: 'portrait' }
      }).save().then(() => {
        document.getElementById("downloadButtons").style.display = "block";
      });
    }

    function downloadImage() {
      document.getElementById("downloadButtons").style.display = "none";
      html2canvas(document.getElementById("invoice"), { scale: 2 }).then(canvas => {
        const link = document.createElement("a");
        link.download = getFileName() + ".png";
        link.href = canvas.toDataURL("image/png");
        link.click();
        document.getElementById("downloadButtons").style.display = "block";
      });
    }

    function shareViaWhatsApp() {
      const id = document.getElementById("invId").value;
      const date = document.getElementById("invDate").value;
      const customer = document.getElementById("custName").value;
      const driver = document.getElementById("driverName").value;
      const vehicle = document.getElementById("vehicleModel").value;
      const total = document.getElementById("total").innerText;
      const note = document.getElementById("note").value;

      const message = `üß≤ *NST Travels Invoice*\n\n*Trip ID:* ${id}\n*Date:* ${date}\n*Customer:* ${customer}\n*Driver:* ${driver}\n*Vehicle:* ${vehicle}\n*Total:* ${total}\n\nüìù *Note:* ${note}`;
      window.open(`https://wa.me/?text=${encodeURIComponent(message)}`, "_blank");
    }

    window.onload = () => {
      populateTripDropdown();
      loadTripData("#NST001");
    };
  </script></body>
</html>