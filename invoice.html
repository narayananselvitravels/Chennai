<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Invoice - NST Travels</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family:'Poppins',sans-serif; background:#f9f9f9; max-width:800px; margin:40px auto; padding:20px; }
    h2 { color:#4b2aad; }
    .invoice-box {
      border:1px solid #ccc; padding:20px; background:#fff;
    }
    select, input, textarea, button {
      padding:10px; font-size:16px; margin:8px 0; width:100%;
      border-radius:5px; border:1px solid #ccc; box-sizing:border-box;
    }
    textarea { resize: vertical; }
    table { width:100%; border-collapse:collapse; margin-top:20px }
    th, td { text-align:left; padding:8px; border-bottom:1px solid #ddd }
    th { background:#4b2aad; color:#fff }
    button { background:#4b2aad; color:#fff; border:none; cursor:pointer; margin-top:10px; }
    button:hover { background:#3a208b; }
  </style>
</head>
<body>

<h2>ðŸ§¾ NST Travels â€“ Invoice Generator</h2>

<select id="tripSelect" onchange="loadTrip()">
  <option value="">-- Select Trip ID --</option>
</select>

<div class="invoice-box" id="invoiceBox" style="display:none;">
  <label><b>Customer Name</b></label>
  <input id="custName">

  <label><b>Customer Number</b></label>
  <input id="custNumber">

  <label><b>Date</b></label>
  <input id="tripDate">

  <label><b>Pickup</b></label>
  <input id="pickup">

  <label><b>Drop</b></label>
  <input id="drop">

  <label><b>Driver Name</b></label>
  <input id="driverName">

  <label><b>Driver Number</b></label>
  <input id="driverNumber">

  <label><b>Vehicle Model</b></label>
  <input id="vehicleModel">

  <label><b>Vehicle Number</b></label>
  <input id="vehicleNo">

  <label><b>Start Time</b></label>
  <input id="start">

  <label><b>End Time</b></label>
  <input id="end">

  <label><b>Duration (hrs)</b></label>
  <input id="duration">

  <label><b>Extra Hours</b></label>
  <input id="extraHours">

  <label><b>Start KM</b></label>
  <input id="startKM">

  <label><b>End KM</b></label>
  <input id="endKM">

  <label><b>Total KM</b></label>
  <input id="totalKM">

  <label><b>Extra KM</b></label>
  <input id="extraKM">

  <label><b>Parking (â‚¹)</b></label>
  <input id="parking" type="number" value="0" oninput="updateTotal()">

  <label><b>Toll (â‚¹)</b></label>
  <input id="toll" type="number" value="0" oninput="updateTotal()">

  <label><b>Total Amount (â‚¹)</b></label>
  <input id="totalAmount" type="number">

  <label><b>Payment Status</b></label>
  <select id="paymentStatus">
    <option>Paid</option>
    <option>Not Paid</option>
  </select>

  <label><b>Note</b></label>
  <textarea id="note" rows="3"></textarea>

  <button onclick="saveInvoice()">ðŸ’¾ Update Trip Invoice</button>
</div>

<script>
  let trips = [];
  let currentIndex = -1;

  function loadTripIDs() {
    trips = JSON.parse(localStorage.getItem("shared-trips") || "[]");
    const select = document.getElementById("tripSelect");
    select.innerHTML = '<option value="">-- Select Trip ID --</option>';
    trips.forEach((trip, index) => {
      const opt = document.createElement("option");
      opt.value = index;
      opt.text = `${trip.id} - ${trip.date}`;
      select.appendChild(opt);
    });
  }

  function loadTrip() {
    currentIndex = document.getElementById("tripSelect").value;
    if (currentIndex === "") {
      document.getElementById("invoiceBox").style.display = "none";
      return;
    }

    const trip = trips[currentIndex];
    if (!trip) return;

    document.getElementById("invoiceBox").style.display = "block";

    custName.value = trip.custName || "";
    custNumber.value = trip.custNumber || "";
    tripDate.value = trip.date || "";
    pickup.value = trip.pickup || "";
    drop.value = trip.drop || "";
    driverName.value = trip.driverName || "";
    driverNumber.value = trip.driverNumber || "";
    vehicleModel.value = trip.vehicleModel || "";
    vehicleNo.value = trip.vehicleNo || "";
    start.value = trip.start || "";
    end.value = trip.end || "";
    duration.value = trip.duration || "";
    extraHours.value = trip.extraHours || "";
    startKM.value = trip.startKM || "";
    endKM.value = trip.endKM || "";
    totalKM.value = trip.totalKM || "";
    extraKM.value = trip.extraKM || "";
    parking.value = trip.parking || 0;
    toll.value = trip.toll || 0;
    totalAmount.value = trip.totalAmount || 0;
    paymentStatus.value = trip.paymentStatus || "";
    note.value = trip.note || "";
  }

  function updateTotal() {
    let parkingVal = parseFloat(parking.value || 0);
    let tollVal = parseFloat(toll.value || 0);
    let totalBase = parseFloat(totalAmount.value || 0);
    totalAmount.value = totalBase + parkingVal + tollVal;
  }

  function saveInvoice() {
    if (currentIndex === -1) return;

    trips[currentIndex] = {
      ...trips[currentIndex],
      custName: custName.value,
      custNumber: custNumber.value,
      date: tripDate.value,
      pickup: pickup.value,
      drop: drop.value,
      driverName: driverName.value,
      driverNumber: driverNumber.value,
      vehicleModel: vehicleModel.value,
      vehicleNo: vehicleNo.value,
      start: start.value,
      end: end.value,
      duration: duration.value,
      extraHours: extraHours.value,
      startKM: startKM.value,
      endKM: endKM.value,
      totalKM: totalKM.value,
      extraKM: extraKM.value,
      parking: parking.value,
      toll: toll.value,
      totalAmount: totalAmount.value,
      paymentStatus: paymentStatus.value,
      note: note.value
    };

    localStorage.setItem("shared-trips", JSON.stringify(trips));
    alert("âœ… Invoice updated successfully.");
  }

  window.onload = loadTripIDs;
</script>

</body>
</html>