<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NST Travels ‚Äì Invoice</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body { font-family: 'Poppins', sans-serif; background: #f5f5f5; padding: 30px; max-width: 850px; margin: auto; }
    h2 { color: #4b2aad; }
    label { font-weight: bold; margin-top: 10px; display: block; }
    input, select, textarea {
      width: 100%; padding: 10px; margin-bottom: 12px;
      border: 1px solid #ccc; border-radius: 5px; font-size: 16px;
    }
    button {
      background: #4b2aad; color: white; padding: 12px 20px; border: none;
      border-radius: 5px; cursor: pointer; font-size: 16px; margin-right: 10px;
    }
    button:hover { background: #3a208b; }
    .invoice-box { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
    .actions { margin-top: 20px; }
    @media print {
      body { padding: 0; }
      .no-print { display: none !important; }
    }
  </style>
</head>
<body>

<h2>üßæ NST Travels ‚Äì Invoice Generator</h2>

<select id="tripSelect" onchange="loadTrip()">
  <option value="">-- Select Trip ID --</option>
</select>

<div class="invoice-box" id="invoiceBox" style="display:none;">
  <label>Customer Name</label><input id="custName">
  <label>Customer Number</label><input id="custNumber">
  <label>Date</label><input id="tripDate">
  <label>Pickup Location</label><input id="pickup">
  <label>Drop Location</label><input id="drop">
  <label>Driver Name</label><input id="driverName">
  <label>Driver Number</label><input id="driverNumber">
  <label>Vehicle Model</label><input id="vehicleModel">
  <label>Vehicle Number</label><input id="vehicleNo">
  <label>Start Time</label><input id="start">
  <label>End Time</label><input id="end">
  <label>Duration (hrs)</label><input id="duration">
  <label>Extra Hours</label><input id="extraHours">
  <label>Start KM</label><input id="startKM">
  <label>End KM</label><input id="endKM">
  <label>Total KM</label><input id="totalKM">
  <label>Extra KM</label><input id="extraKM">
  <label>Parking ‚Çπ</label><input id="parking" type="number" value="0" oninput="updateTotal()">
  <label>Toll ‚Çπ</label><input id="toll" type="number" value="0" oninput="updateTotal()">
  <label>Total Amount ‚Çπ</label><input id="totalAmount" type="number">
  <label>Payment Status</label>
  <select id="paymentStatus">
    <option>Paid</option>
    <option>Not Paid</option>
  </select>
  <label>Note</label><textarea id="note" rows="3"></textarea>

  <div class="actions no-print">
    <button onclick="saveInvoice()">üíæ Update Invoice</button>
    <button onclick="print()">üñ®Ô∏è Print Invoice</button>
    <button onclick="shareWhatsApp()">üì§ Share on WhatsApp</button>
  </div>
</div>

<script>
  let trips = [];
  let currentIndex = -1;

  function loadTripIDs() {
    trips = JSON.parse(localStorage.getItem("shared-trips") || "[]");
    const select = document.getElementById("tripSelect");
    select.innerHTML = '<option value="">-- Select Trip ID --</option>';
    trips.forEach((trip, index) => {
      const opt = document.createElement("option");
      opt.value = index;
      opt.text = `${trip.id} - ${trip.date}`;
      select.appendChild(opt);
    });
  }

  function loadTrip() {
    currentIndex = tripSelect.value;
    if (currentIndex === "") {
      invoiceBox.style.display = "none";
      return;
    }

    const t = trips[currentIndex];
    invoiceBox.style.display = "block";

    custName.value = t.custName || "";
    custNumber.value = t.custNumber || "";
    tripDate.value = t.date || "";
    pickup.value = t.pickup || "";
    drop.value = t.drop || "";
    driverName.value = t.driverName || "";
    driverNumber.value = t.driverNumber || "";
    vehicleModel.value = t.vehicleModel || "";
    vehicleNo.value = t.vehicleNo || "";
    start.value = t.start || "";
    end.value = t.end || "";
    duration.value = t.duration || "";
    extraHours.value = t.extraHours || "";
    startKM.value = t.startKM || "";
    endKM.value = t.endKM || "";
    totalKM.value = t.totalKM || "";
    extraKM.value = t.extraKM || "";
    parking.value = t.parking || 0;
    toll.value = t.toll || 0;
    totalAmount.value = t.totalAmount || 0;
    paymentStatus.value = t.paymentStatus || "";
    note.value = t.note || "";
  }

  function updateTotal() {
    let parkingVal = parseFloat(parking.value || 0);
    let tollVal = parseFloat(toll.value || 0);
    let base = parseFloat(totalAmount.value || 0);
    totalAmount.value = (base + parkingVal + tollVal).toFixed(2);
  }

  function saveInvoice() {
    if (currentIndex === -1) return;

    trips[currentIndex] = {
      ...trips[currentIndex],
      custName: custName.value,
      custNumber: custNumber.value,
      date: tripDate.value,
      pickup: pickup.value,
      drop: drop.value,
      driverName: driverName.value,
      driverNumber: driverNumber.value,
      vehicleModel: vehicleModel.value,
      vehicleNo: vehicleNo.value,
      start: start.value,
      end: end.value,
      duration: duration.value,
      extraHours: extraHours.value,
      startKM: startKM.value,
      endKM: endKM.value,
      totalKM: totalKM.value,
      extraKM: extraKM.value,
      parking: parking.value,
      toll: toll.value,
      totalAmount: totalAmount.value,
      paymentStatus: paymentStatus.value,
      note: note.value
    };

    localStorage.setItem("shared-trips", JSON.stringify(trips));
    alert("‚úÖ Invoice updated successfully.");
  }

  function shareWhatsApp() {
    const t = trips[currentIndex];
    if (!t) return;

    let msg = `üìã *NST TRIP SUMMARY*\n\n`;

    function add(label, value) {
      if (value && value.trim()) msg += `‚Ä¢ *${label}:* ${value}\n`;
    }

    msg += `üóìÔ∏è *TRIP DETAILS*\n`;
    add("Trip ID", t.id);
    add("Date", t.date);

    msg += `\nüìç *LOCATIONS*\n`;
    add("Pickup", t.pickup);
    add("Drop", t.drop);

    msg += `\nüë§ *CUSTOMER INFO*\n`;
    add("Name", t.custName);
    add("Number", t.custNumber);

    msg += `\nüë®‚Äç‚úàÔ∏è *DRIVER INFO*\n`;
    add("Name", t.driverName);
    add("Number", t.driverNumber);

    msg += `\nüöò *VEHICLE INFO*\n`;
    add("Model", t.vehicleModel);
    add("Number", t.vehicleNo);

    msg += `\nüïí *TIME DETAILS*\n`;
    add("Start Time", t.start);
    add("End Time", t.end);
    add("Duration", t.duration + " hrs");
    add("Extra Hours", t.extraHours);

    msg += `\nüìè *DISTANCE DETAILS*\n`;
    add("Start KM", t.startKM);
    add("End KM", t.endKM);
    add("Total KM", t.totalKM + " km");
    add("Extra KM", t.extraKM + " km");

    msg += `\nüí∞ *FARE DETAILS*\n`;
    add("Parking", "‚Çπ" + t.parking);
    add("Toll", "‚Çπ" + t.toll);
    add("Total Amount", "‚Çπ" + t.totalAmount);
    add("Payment Status", t.paymentStatus);

    msg += `\nüìù *NOTE*\n${t.note || "-"}`;

    window.open("https://wa.me/?text=" + encodeURIComponent(msg), "_blank");
  }

  window.onload = loadTripIDs;
</script>

</body>
</html>