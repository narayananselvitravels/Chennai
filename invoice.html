<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Invoice - NST Travels</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Poppins', sans-serif;
      background: #f4f6f9;
      padding: 20px;
      max-width: 900px;
      margin: auto;
    }
    h2 {
      color: #4b2aad;
      margin-bottom: 10px;
    }
    select, input {
      padding: 10px;
      margin-bottom: 15px;
      width: 100%;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 6px;
    }
    .invoice-box {
      background: #fff;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 0 10px rgba(0,0,0,0.1);
    }
    .group { display: flex; gap: 20px; flex-wrap: wrap; }
    .group > div { flex: 1; min-width: 250px; }
    label { font-weight: 600; display: block; margin-top: 10px; }
    button {
      background: #4b2aad;
      color: white;
      border: none;
      padding: 12px 18px;
      border-radius: 5px;
      font-size: 15px;
      margin-right: 10px;
      cursor: pointer;
    }
    button:hover { background: #3a208b; }
    .btns { margin-top: 20px; }
  </style>
</head>
<body>

<h2>üßæ NST Invoice Generator</h2>

<label>Select Trip ID</label>
<select id="tripSelect" onchange="fillInvoice()">
  <option value="">-- Select --</option>
</select>

<div class="invoice-box" id="invoiceArea">
  <h3 style="text-align:center;">NST Travels ‚Äì Invoice</h3>
  <div class="group">
    <div>
      <label>Trip ID</label>
      <input id="tripId" />
    </div>
    <div>
      <label>Date</label>
      <input id="tripDate" />
    </div>
  </div>

  <div class="group">
    <div>
      <label>Customer Name</label>
      <input id="custName" />
    </div>
    <div>
      <label>Customer Number</label>
      <input id="custNumber" />
    </div>
  </div>

  <div class="group">
    <div>
      <label>Driver Name</label>
      <input id="driverName" />
    </div>
    <div>
      <label>Driver Number</label>
      <input id="driverNumber" />
    </div>
  </div>

  <div class="group">
    <div>
      <label>Vehicle Model</label>
      <input id="vehicleModel" />
    </div>
    <div>
      <label>Vehicle Number</label>
      <input id="vehicleNo" />
    </div>
  </div>

  <div class="group">
    <div>
      <label>Pickup Location</label>
      <input id="pickup" />
    </div>
    <div>
      <label>Drop Location</label>
      <input id="drop" />
    </div>
  </div>

  <div class="group">
    <div>
      <label>Duration (hrs)</label>
      <input id="duration" />
    </div>
    <div>
      <label>Extra Hours</label>
      <input id="extraHours" />
    </div>
  </div>

  <div class="group">
    <div>
      <label>Total KM</label>
      <input id="totalKM" />
    </div>
    <div>
      <label>Extra KM</label>
      <input id="extraKM" />
    </div>
  </div>

  <div class="group">
    <div>
      <label>Toll ‚Çπ</label>
      <input id="toll" type="number" value="0" oninput="recalcTotal()" />
    </div>
    <div>
      <label>Parking ‚Çπ</label>
      <input id="parking" type="number" value="0" oninput="recalcTotal()" />
    </div>
  </div>

  <div class="group">
    <div>
      <label>Total Amount ‚Çπ</label>
      <input id="totalAmount" type="number" value="0" oninput="recalcTotal()" />
    </div>
    <div>
      <label>Payment Status</label>
      <input id="paymentStatus" />
    </div>
  </div>
</div>

<div class="btns">
  <button onclick="generatePDF()">üìÑ Export PDF</button>
  <button onclick="saveImage()">üñºÔ∏è Save as Image</button>
  <button onclick="window.print()">üñ®Ô∏è Print</button>
</div>

<script>
  function loadTrips() {
    let trips = JSON.parse(localStorage.getItem("shared-trips") || "[]");
    const sel = document.getElementById("tripSelect");
    trips.forEach(t => {
      const opt = document.createElement("option");
      opt.value = t.id;
      opt.textContent = t.id;
      sel.appendChild(opt);
    });
  }

  function fillInvoice() {
    const tripId = tripSelect.value;
    if (!tripId) return;
    const trips = JSON.parse(localStorage.getItem("shared-trips") || "[]");
    const trip = trips.find(t => t.id === tripId);
    if (!trip) return alert("Trip not found");

    tripIdInput.value = trip.id;
    tripDate.value = trip.date || "";
    custName.value = trip.custName || "";
    custNumber.value = trip.custNumber || "";
    driverName.value = trip.driverName || "";
    driverNumber.value = trip.driverNumber || "";
    vehicleModel.value = trip.vehicleModel || "";
    vehicleNo.value = trip.vehicleNo || "";
    pickup.value = trip.pickup || "";
    drop.value = trip.drop || "";
    duration.value = trip.duration || "";
    extraHours.value = trip.extraHours || "";
    totalKM.value = trip.totalKM || "";
    extraKM.value = trip.extraKM || "";
    totalAmount.value = trip.totalAmount || "0";
    paymentStatus.value = trip.paymentStatus || "";
    toll.value = trip.toll || "0";
    parking.value = trip.parking || "0";
  }

  function recalcTotal() {
    let amt = parseFloat(totalAmount.value) || 0;
    let t = parseFloat(toll.value) || 0;
    let p = parseFloat(parking.value) || 0;
    totalAmount.value = amt + t + p;
  }

  function generatePDF() {
    const element = document.getElementById("invoiceArea");
    html2pdf().from(element).save("NST_Invoice.pdf");
  }

  function saveImage() {
    html2canvas(document.getElementById("invoiceArea")).then(canvas => {
      const a = document.createElement("a");
      a.href = canvas.toDataURL("image/png");
      a.download = "NST_Invoice.png";
      a.click();
    });
  }

  window.onload = () => {
    window.tripIdInput = document.getElementById("tripId");
    loadTrips();
  };
</script>

</body>
</html>